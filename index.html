<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Daily Cryptojoke Puzzle</title>
<style>
  :root {
    --teal: #1f9dbf;
    --gold: #f5b041;
    --gray: #555;
    --light-bg: #faf9f6;
  }

  html, body {
    margin: 0;
    padding: 0;
    background: var(--light-bg);
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    overflow-x: hidden;
  }

  .puzzle-container {
    width: 100%;
    max-width: 600px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 16px;
    padding: 1.2em;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    box-sizing: border-box;
    margin: 0.8em;
    transform-origin: top center;
  }

  h3 {
    text-align: center;
    color: var(--teal);
    font-size: clamp(1.2em, 4vw, 1.5em);
    margin-top: 0;
    margin-bottom: 0.4em;
  }

  .instructions {
    text-align: center;
    font-style: italic;
    color: #666;
    margin-bottom: 1em;
    font-size: clamp(0.9em, 3.5vw, 1em);
  }

  #cryptogram {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px 8px;
    font-family: monospace;
    font-size: clamp(16px, 4vw, 20px);
    line-height: 1.6;
    margin-bottom: 1.5em;
    overflow-x: hidden;
    padding: 0 0.5em;
  }

  input[type=text] {
    width: clamp(34px, 8vw, 44px);
    height: clamp(34px, 8vw, 44px);
    font-size: clamp(16px, 4vw, 20px);
    text-align: center;
    text-transform: uppercase;
    border: 1.5px solid #ccc;
    border-radius: 8px;
    padding: 0;
    transition: border 0.2s ease, background 0.2s ease;
    flex-shrink: 0;
    box-sizing: border-box;
  }

  input[type=text]:focus {
    outline: none;
    border: 1.5px solid var(--teal);
    background: #e8f8fb;
  }

  .button-row {
    text-align: center;
    margin-top: 1em;
  }

  button {
    padding: 10px 16px;
    margin: 6px;
    border: none;
    border-radius: 8px;
    background: var(--gold);
    color: #333;
    cursor: pointer;
    font-family: inherit;
    font-size: clamp(15px, 3.5vw, 16px);
    transition: background 0.2s ease, transform 0.1s ease;
  }

  button:hover {
    background: #d9951f;
    color: #fff;
  }

  button:active {
    transform: scale(0.97);
  }

  /* Adaptive scaling for tiny viewports (keeps edges from cropping) */
  @media (max-width: 420px) {
    .puzzle-container { transform: scale(0.96); width: 103%; }
  }
  @media (max-width: 380px) {
    .puzzle-container { transform: scale(0.92); width: 108%; }
  }
  @media (max-width: 340px) {
    .puzzle-container { transform: scale(0.88); width: 114%; }
  }
  @media (max-width: 320px) {
    .puzzle-container { transform: scale(0.84); width: 120%; }
  }
</style>
</head>
<body>
  <div class="puzzle-container" role="main" aria-label="Cryptogram puzzle">
    <h3>Daily Cryptojoke</h3>
    <p class="instructions">Type your guesses below each letter. Your progress is saved automatically.</p>

    <div id="cryptogram" aria-live="polite"></div>

    <div class="button-row">
      <button id="clearBtn" aria-label="Clear my answers">ðŸ”„ Clear My Answers</button>
    </div>
  </div>

<script>
(function(){
  // Puzzle phrase
  const phrase = "FSW ROR DST CZQNTZNLF FOH QH QFQNR? MTZQACT ST FQC LADCDQHROHP OH SOC YOTIR.";

  // DOM
  const container = document.getElementById("cryptogram");
  const clearBtn = document.getElementById("clearBtn");

  // Storage keys
  const STORAGE_KEY = "cryptojoke-progress";
  const CLEAR_FLAG = "cryptojoke-cleared";

  // Helpers: cookies
  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + (days*24*60*60*1000));
    document.cookie = `${name}=${value};expires=${d.toUTCString()};path=/`;
  }
  function getCookie(name) {
    const cname = name + "=";
    const decoded = decodeURIComponent(document.cookie || "");
    const ca = decoded ? decoded.split(';') : [];
    for(let c of ca){
      while(c.charAt(0) === ' ') c = c.substring(1);
      if(c.indexOf(cname) === 0) return c.substring(cname.length,c.length);
    }
    return "";
  }

  // initialize saved data (respect clear flag cookie)
  const isCleared = getCookie(CLEAR_FLAG) === "true";
  let saved = {};
  try {
    if (!isCleared) {
      saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    } else {
      saved = {};
    }
  } catch (e) {
    saved = {};
  }

  // build puzzle UI (words kept intact)
  const inputs = [];
  phrase.split(" ").forEach((word, wIndex) => {
    const wordDiv = document.createElement("div");
    wordDiv.style.display = "inline-flex";
    wordDiv.style.flexWrap = "nowrap";
    wordDiv.style.alignItems = "flex-end";

    word.split("").forEach((ch, cIndex) => {
      if (/[A-Z]/.test(ch)) {
        const cell = document.createElement("div");
        cell.style.display = "flex";
        cell.style.flexDirection = "column";
        cell.style.alignItems = "center";
        cell.style.width = "auto";
        cell.style.boxSizing = "border-box";

        const top = document.createElement("div");
        top.textContent = ch;
        top.style.fontWeight = "700";
        top.style.marginBottom = "6px";
        top.style.color = "var(--teal)";
        top.style.fontSize = "clamp(16px, 3.5vw, 18px)";

        const box = document.createElement("input");
        box.type = "text";
        box.maxLength = 1;
        box.setAttribute("inputmode", "latin");
        box.setAttribute("aria-label", `Letter ${ch}`);
        box.style.boxSizing = "border-box";

        const id = `${wIndex}-${cIndex}`;
        if (saved[id]) box.value = saved[id];

        box.addEventListener("input", (e) => {
          e.target.value = e.target.value.toUpperCase();
          saved[id] = e.target.value;
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
          } catch (err) {
            // ignore storage errors silently
          }
          // ensure clear flag cookie reset so saved values persist
          setCookie(CLEAR_FLAG, "false", 7);
        });

        inputs.push({ id, box });
        cell.appendChild(top);
        cell.appendChild(box);
        wordDiv.appendChild(cell);
      } else {
        const punct = document.createElement("div");
        punct.textContent = ch;
        punct.style.marginLeft = "8px";
        punct.style.fontWeight = "700";
        punct.style.color = "var(--teal)";
        punct.style.fontSize = "clamp(16px, 3.5vw, 18px)";
        wordDiv.appendChild(punct);
      }
    });

    // small gap after word
    wordDiv.style.marginRight = "10px";
    container.appendChild(wordDiv);
  });

  // Clear answers (localStorage + cookie)
  clearBtn.addEventListener("click", () => {
    inputs.forEach(({ box }) => box.value = "");
    try {
      localStorage.removeItem(STORAGE_KEY);
    } catch (e) {}
    setCookie(CLEAR_FLAG, "true", 7);
    // some browsers need a slight delay before reflow in iframe contexts
    setTimeout(() => {}, 100);
  });

  // Accessibility: focus first input when visible
  if (inputs.length > 0) {
    try { inputs[0].box.setAttribute("aria-hidden", "false"); } catch(e){}
  }
})();
</script>
</body>
</html>
